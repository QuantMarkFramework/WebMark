{% extends "rest_framework/base.html" %}

{% block title %}QuantMark2 Detail: {{ batch_id }}{% endblock %}

{% block style %}
{{ block.super }}
<style type="text/css">
  table.data th,td {
    padding-right: 5px;
    padding-left: 5px;
  }
  th.right,td.right {
    text-align: right;
  }
</style>
{% endblock %}

{% block content %}
<div class="starter-template">
  <h1>Batch {{ batch_id }} details:</h1>
  <div style="width: 30%; float: left; margin: 5%">
    <table width="100%">
      <tr>
        <td>Created: </td>
        <td>{{ results.0.created|date:"Y-m-d H:i" }}</td>
      </tr>
      <tr>
        <td>Batch id: </td>
        <td>{{ batch_id }}</td>
      </tr>
      <tr>
        <td>Optimizer: </td>
        <td>{{ results.0.optimizer }}</td>
      </tr>
      <tr>
        <td>Tequila version: </td>
        <td>{{ results.0.tqversion }}</td>
      </tr>
    </table>

    <p>&nbsp;</p>

    <table class="data" width="100%">
      <thead>
        <th class="right">Energy</th>
        <th class="right">Dist.</th>
        <th class="right">Fun</th>
        <th class="right">NFEv</th>
      </thead>
      {% for result in results %}
      <tr>
        <td class="right">{{ result.energy|floatformat:3 }}</td>
        <td class="right">{{ result.distance|floatformat:3 }}</td>
        <td class="right">{{ result.fun|floatformat:3 }}</td>
        <td class="right">{{ result.nfev }}</td>
      </tr>
      {% endfor %}
    </table>
    <hr />
  </div>
  <div style="width: 50%; float: left; margin: 5%">
    <div id="dis-energy-chart"></div>
  </div>
</div>
{% endblock %}

{% block script %}
{{ block.super }}
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
  google.charts.load('current', { 'packages': ['corechart'] });
  google.charts.setOnLoadCallback(drawChart);

  function drawChart() {
    var energies = {{ energies }}
    var distances = {{ distances }}
    
    var name = "{{ name }}"

    var data = new google.visualization.DataTable();
    data.addColumn('number', '')
    data.addColumn('number', name)

    for (i = 0; i < energies.length; i++) {
      data.addRow([distances[i], energies[i]])
    }

    const options = {
      width: 500,
      height: 500,
      pointsVisible: true,
      legend: { position: 'bottom' },

      hAxis: {
        title: 'Distance',
      },
      vAxis: {
        title: "Energy",
      },
      explorer: {
        keepInBounds: true,
      }
    };

    var chart = new google.visualization.LineChart(document.getElementById('dis-energy-chart'))
    chart.draw(data, options)
  }

</script>
{% endblock%}